# ๐ URL Shortener with .NET 9, Redis & RabbitMq

ฺฉ ุณุฑูุณ ฺฉูุชุงูโฺฉููุฏู ููฺฉ ูุฏุฑู ฺฉู ุจุง **.NET 9** ุณุงุฎุชู ุดุฏู ู ุดุงูู ูุงุจูุชโูุง ูพุดุฑูุชู ูุซู **Rate Limiting** ุจุง ุงุณุชูุงุฏู ุงุฒ **Redis + Lua Script** ุงุณุช.

---

## โจ ูฺฺฏโูุง

- ฺฉูุชุงูโฺฉุฑุฏู ููฺฉโูุง ุทููุงู ุจู ุขุฏุฑุณโูุง ฺฉูุชุงู ู ูุงุจู ุงุดุชุฑุงฺฉโฺฏุฐุงุฑ
- API ุฏูุณุชุงูู ู ููุงุณโูพุฐุฑ ุจุฑุง ุงุณุชูุงุฏู ุฏุฑ ูุฑุงูุชโุงูุฏูุง (ูุซู Next.js)
- **Token Bucket Rate Limiting** ุจุฑุง ุฌููฺฏุฑ ุงุฒ abuse
- **ุณุณุชู Click Tracking ุจุง RabbitMQ**
  - ูุฑ ฺฉูฺฉ ุฑู ููฺฉโูุง ุฏุฑ ุตู RabbitMQ ุฐุฎุฑู ูโุดูุฏ
  - ฺฉ **Background Service** ฺฉูฺฉโูุง ุฑุง ุงุฒ ุตู ูโุฎูุงูุฏ ู ุจู ุฏุชุงุจุณ ุงุถุงูู ูโฺฉูุฏ
  - ุงู ุฏุงุฏูโูุง ุจุฑุง **Analytics** ุงุณุชูุงุฏู ูโุดููุฏ (ูุซู ุชุนุฏุงุฏ ุจุงุฒุฏุฏ ูุฑ ููฺฉ)
- ูพุงุฏูโุณุงุฒ **Atomic Operations** ุฏุฑ Redis ุจุง Lua Script
- ุฐุฎุฑู ููฺฉโูุง ู ูุชุงุฏุชุง ุฏุฑ ุฏุชุงุจุณ (default MongoDb)

---

## โ๏ธ ูพุดโูุงุฒูุง

- [.NET 9 SDK](https://dotnet.microsoft.com/)
- [Docker (for redis and rabbitmq)](https://www.docker.com/)
- [Redis](https://redis.io/)
- [RabbitMQ](https://www.rabbitmq.com/)
- [MongoDb](https://www.mongodb.com/)
- [Postman](https://www.postman.com/) ุง ุงุจุฒุงุฑ ูุดุงุจู ุจุฑุง ุชุณุช API

---

## ๐ ูุตุจ ู ุงุฌุฑุง

1. **ฺฉููู ฺฉุฑุฏู ูพุฑูฺู**
```bash
git clone https://github.com/MehdiMasoumii/Url-Shortener.git
cd Url-Shortener
```

2. **ุฑุงูโุงูุฏุงุฒ Redis , RabbitMq (ุจุง Docker)**
```bash
docker compose -f compose.yaml up -d
```

3. **ุงุฌุฑุง ูพุฑูฺู**
```bash
dotnet run --project WebApi
```


## ๐ก Rate Limiting ุจุง Redis + Lua

ุงู ูพุฑูฺู ุงุฒ ุงูฺฏูุฑุชู **Token Bucket** ุงุณุชูุงุฏู ูโฺฉูุฏ  
ุชุง ุชุนุฏุงุฏ ุฏุฑุฎูุงุณุชโูุง ูุฑ ฺฉุงุฑุจุฑ ุฏุฑ ฺฉ ุจุงุฒู ุฒูุงู ูุดุฎุต ูุญุฏูุฏ ุดูุฏ.  

ูฺฺฏ ฺฉูุฏ:
- ุฐุฎุฑูโุณุงุฒ ุขุฎุฑู ุฒูุงู refill ุฏุฑ Redis (`last_refill`)
- ูุญุงุณุจู ุชุนุฏุงุฏ ุชูฺฉูโูุง ุฌุฏุฏ ุจุฑ ุงุณุงุณ `TimeOffset`
- ุงูุฌุงู ฺฉู ุนููุงุช (ฺฺฉ ฺฉุฑุฏู ู ุขูพุฏุช) ุจูโุตูุฑุช **Atomic** ุจุง Lua Script

ููููู ุงุณฺฉุฑูพุช Lua:
```lua
local data = redis.call('HGETALL', KEYS[1]);
  if #data == 0 then
    redis.call('HSETEX', KEYS[1], 'EX', ARGV[1], 'FIELDS', 2, ARGV[2], ARGV[3], ARGV[4], ARGV[5]);
    return 1;
  else
    local offset = tonumber(ARGV[5]) - tonumber(data[2]);
    local newTokenCount = math.min(math.floor(offset / tonumber(ARGV[6])), tonumber(ARGV[3])) + tonumber(data[4]) - 1;

    if newTokenCount >= 0 then
      redis.call('HSETEX', KEYS[1], 'EX', ARGV[1], 'FIELDS', 2, ARGV[2], math.min(newTokenCount, tonumber(ARGV[3])), ARGV[4], ARGV[5]);
      return 1;
    else
      return 0;
  end
end
```

---

## ๐ ุงุญุฑุงุฒ ููุช ู ุณุทุญ ุฏุณุชุฑุณ

- **ฺฉุงุฑุจุฑ ุนุงุฏ:** ูโุชูุงูุฏ ููฺฉ ุงุฌุงุฏุ ูุฑุงุด ุง ุญุฐู ฺฉูุฏ (ููุท ููฺฉโูุง ุฎูุฏุด)
* ุงู ูุณุฎู mvp ูุณุชุด ู ูุนูุง ููุท ฺฉุงุฑุจุฑ ูุนููู ูุฌูุฏ ุฏุงุฑูุ ุงูุง ุฏุฑ ุงุฏุงูู premium user ูุง ู ... ุงุถุงูู ุฎูุงููุฏ ุดุฏ!
---

## ๐ ุจุฑูุงููโูุง ุขูุฏู (TODO)

- [ ] ุงูุฒูุฏู ุณุณุชู ุขูุงุฑ ฺฉูฺฉโูุง
- [ ] ุฏุงุดุจูุฑุฏ ูุฑุงูุชโุงูุฏ ุจุง Next.js
- [ ] ฺฉุด ูพุดุฑูุชู ุจุฑุง ููฺฉโูุง
- [ ] ูพุดุชุจุงู ุงุฒ ููฺฉโูุง ูููุช (TTL)

---

## ๐ ูุงุณูุณ
ุงู ูพุฑูฺู ุชุญุช ูุงุณูุณ MIT ููุชุดุฑ ุดุฏู ุงุณุช.  
ุงุณุชูุงุฏู ุขุฒุงุฏุ ุชุบุฑ ู ุชูุฒุน ูุฌุงุฒ ุงุณุช.

---
